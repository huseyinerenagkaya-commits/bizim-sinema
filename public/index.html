<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bizim Sinema OdasÄ±</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background-color: #1a1a1a; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .kutu { background-color: #333; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: inline-block; width: 80%; max-width: 600px; }
        input { width: 90%; padding: 10px; border-radius: 5px; border: none; margin-top: 10px; }
        video { width: 100%; max-width: 800px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); background: black; }
        .container { display: flex; flex-direction: column; align-items: center; }
        #icerik { display: none; } /* Åifre girilmeden Ã¶nce iÃ§eriÄŸi gizler */
    </style>
</head>
<body>

    <div id="icerik">
        <h2>ğŸ¿ BaÅŸ BaÅŸa Sinema OdasÄ±</h2>
        <div class="container">
            <div class="kutu">
                <label>Ä°zlenecek Filmin Linkini Buraya YapÄ±ÅŸtÄ±rÄ±n (.mp4):</label>
                <input type="text" id="videoUrl" placeholder="Ã–rn: https://site.com/film.mp4">
            </div>
            <video id="player" controls>
                <source id="videoSource" src="" type="video/mp4">
            </video>
        </div>
    </div>

    <script>
        // --- ÅÄ°FRE KONTROL SÄ°STEMÄ° ---
        const gizliSifre = "2026"; // Buradaki 2026 yerine istediÄŸin ÅŸifreyi yazabilirsin
        const kayitliSifre = localStorage.getItem("sinemaSifre");

        if (kayitliSifre !== gizliSifre) {
            let girilen = prompt("Siteye giriÅŸ iÃ§in ÅŸifreyi girin:");
            if (girilen === gizliSifre) {
                // Åifre doÄŸruysa cihaza kaydet ve iÃ§eriÄŸi gÃ¶ster
                localStorage.setItem("sinemaSifre", girilen);
                document.getElementById("icerik").style.display = "block";
            } else {
                // Åifre yanlÄ±ÅŸsa sayfayÄ± kitle
                document.body.innerHTML = "<h2 style='color:red; text-align:center; margin-top:50px;'>YanlÄ±ÅŸ ÅŸifre! SayfayÄ± yenileyip tekrar deneyin.</h2>";
                throw new Error("YanlÄ±ÅŸ ÅŸifre girildi."); 
            }
        } else {
            // Cihaz ÅŸifreyi zaten hatÄ±rlÄ±yorsa direkt iÃ§eriÄŸi gÃ¶ster
            document.getElementById("icerik").style.display = "block";
        }

        // --- VÄ°DEO SENKRONÄ°ZASYON KODLARI ---
        const socket = io();
        const video = document.getElementById('player');
        const videoUrl = document.getElementById('videoUrl');
        const videoSource = document.getElementById('videoSource');
        let disaridanGeldi = false;

        videoUrl.addEventListener('change', () => {
            const url = videoUrl.value;
            socket.emit('link_degisti', url);
            videoSource.src = url;
            video.load();
        });

        socket.on('link_degisti', (url) => {
            videoUrl.value = url;
            videoSource.src = url;
            video.load();
        });

        video.addEventListener('play', () => { if (!disaridanGeldi) socket.emit('oynat', video.currentTime); disaridanGeldi = false; });
        socket.on('oynat', (zaman) => { disaridanGeldi = true; if (Math.abs(video.currentTime - zaman) > 1) video.currentTime = zaman; video.play(); });

        video.addEventListener('pause', () => { if (!disaridanGeldi) socket.emit('durdur', video.currentTime); disaridanGeldi = false; });
        socket.on('durdur', (zaman) => { disaridanGeldi = true; video.currentTime = zaman; video.pause(); });

        video.addEventListener('seeked', () => { if (!disaridanGeldi) socket.emit('sar', video.currentTime); disaridanGeldi = false; });
        socket.on('sar', (zaman) => { disaridanGeldi = true; video.currentTime = zaman; });
    </script>
</body>
</html>
